<!DOCTYPE html>
<html>
<head>
    <title>Test Generate Candidates API</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>測試 Generate Candidates API</h1>
    <button onclick="testAPI()">測試 API</button>
    <div id="result"></div>

    <script>
    async function testAPI() {
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = '正在測試...';
        
        const payload = {
            filtering_parameters: {
                start_date: "2025-08-11",
                end_date: "2025-08-13",
                start_time: "00:00",
                end_time: "00:00",
                z_score_threshold: 1.7,
                spike_percentage: 60.0,
                min_event_duration_minutes: 30,
                detect_holiday_pattern: false,
                max_time_gap_minutes: 15,
                peer_agg_window_minutes: 60,
                peer_exceed_percentage: 150.0,
                selected_floors_by_building: {"15學舍": ["1", "2"]}
            }
        };
        
        console.log('發送的參數:', payload);
        
        try {
            const response = await fetch(
                'http://localhost:8000/api/v1/experiment-runs/bc37eb3c-aff3-4c05-a2ad-6e272887f5b4/candidates/generate?allow_overwrite=true',
                {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                }
            );
            
            console.log('回應狀態:', response.status);
            
            if (response.ok) {
                const result = await response.json();
                console.log('成功回應:', result);
                resultDiv.innerHTML = `<h3>成功!</h3><pre>${JSON.stringify(result, null, 2)}</pre>`;
            } else {
                const errorText = await response.text();
                console.error('錯誤回應:', errorText);
                resultDiv.innerHTML = `<h3>錯誤 ${response.status}</h3><pre>${errorText}</pre>`;
            }
        } catch (error) {
            console.error('請求失敗:', error);
            resultDiv.innerHTML = `<h3>請求失敗</h3><pre>${error.message}</pre>`;
        }
    }
    </script>
</body>
</html>
